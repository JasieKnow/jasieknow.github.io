<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Jan Nowacki - Strona osobista</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Favicon z inicja≈Çami JN -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23FFD700'/><text x='50' y='68' font-family='Arial, sans-serif' font-size='50' font-weight='bold' text-anchor='middle' fill='%234f5c2b'>JN</text></svg>">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  
  <style>
    :root {
      --primary-color: #6b7a3c;
      --secondary-color: #4f5c2b;
      --nav-color: #3e4a20;
      --card-color: #5a6933;
      --text-color: #f5f5f0;
      --accent-color: #ffd700;
      --shadow: rgba(0,0,0,0.3);
    }

    [data-theme="light"] {
      --primary-color: #e8f4f8;
      --secondary-color: #b8d4dc;
      --nav-color: #9bb9c2;
      --card-color: #d4e7ed;
      --text-color: #333333;
      --accent-color: #ff6b00;
      --shadow: rgba(0,0,0,0.1);
    }

    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background-color: var(--primary-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      -webkit-tap-highlight-color: transparent;
    }

    header {
      background-color: var(--secondary-color);
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.3s;
      position: relative;
    }

    header:hover {
      background-color: var(--nav-color);
    }

    header h1 {
      margin: 0;
      font-size: 36px;
      letter-spacing: 2px;
    }

    /* Przycisk zmiany motywu */
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--accent-color);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      color: #000;
    }

    /* Wyszukiwarka */
    .search-container {
      max-width: 800px;
      margin: 0 auto 30px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      background: var(--card-color);
      color: var(--text-color);
      font-size: 16px;
      box-shadow: 0 4px 6px var(--shadow);
    }

    .search-input::placeholder {
      color: var(--text-color);
      opacity: 0.7;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 40px;
      background-color: var(--nav-color);
      padding: 15px 0;
      flex-wrap: wrap;
    }

    nav a {
      color: var(--text-color);
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      padding: 5px 15px;
      border-radius: 5px;
      transition: background-color 0.3s;
    }

    nav a:hover {
      background-color: var(--secondary-color);
    }

    .section {
      display: none;
      padding: 40px 20px;
      max-width: 1200px;
      margin: auto;
    }

    .section.active {
      display: block;
    }

    h2 {
      border-bottom: 2px solid var(--text-color);
      padding-bottom: 10px;
      margin-bottom: 30px;
    }

    .columns {
      display: flex;
      gap: 40px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .column {
      flex: 1;
      min-width: 300px;
    }

    .movie-grid, .series-grid, .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }

    .movie-card, .series-card, .game-card {
      background-color: var(--card-color);
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative;
    }

    .movie-card:hover, .series-card:hover, .game-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px var(--shadow);
    }

    /* ≈örednia ocena w lewym g√≥rnym rogu zdjƒôcia */
    .card-rating-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: #ffd700;
      padding: 5px 10px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 10;
    }

    .movie-img, .series-img, .game-img {
      width: 100%;
      height: 250px;
      object-fit: cover;
    }

    .movie-info, .series-info, .game-info {
      padding: 15px;
    }

    .movie-title, .series-title, .game-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .movie-desc, .series-desc, .game-desc {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    /* System ocen na karcie */
    .card-rating {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
      margin-top: 10px;
    }

    .rating-stars {
      color: var(--accent-color);
    }

    .rating-count {
      opacity: 0.7;
      font-size: 12px;
    }

    .game-list {
      list-style-type: none;
      padding: 0;
    }

    .game-list li {
      background-color: var(--card-color);
      margin: 15px 0;
      padding: 15px;
      border-radius: 10px;
      font-size: 18px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .game-list li:hover {
      transform: translateX(10px);
    }

    .game-icon {
      font-size: 30px;
      margin-right: 15px;
    }

    .game-name {
      flex-grow: 1;
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      opacity: 0.8;
    }
    
    .welcome-message {
      text-align: center;
      padding: 60px 20px;
      font-size: 20px;
      color: var(--text-color);
      opacity: 0.8;
    }

    .back-link {
      display: inline-block;
      margin-top: 20px;
      color: var(--accent-color);
      text-decoration: none;
      font-weight: bold;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    /* Styl dla przycisk√≥w - czarny tekst na ≈º√≥≈Çtym tle */
    .filmweb-button, .trailer-button, .submit-rating, .change-rating-button {
      background: var(--accent-color);
      color: #000000 !important;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 10px 0 0;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      transition: opacity 0.3s;
    }
    
    .filmweb-button:hover, .trailer-button:hover, .submit-rating:hover, .change-rating-button:hover {
      opacity: 0.9;
    }

    /* System ocen w szczeg√≥≈Çach */
    .details-rating {
      margin: 20px 0;
      padding: 15px;
      background: var(--card-color);
      border-radius: 10px;
    }

    .rating-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .user-rating {
      display: flex;
      gap: 5px;
      cursor: pointer;
    }

    .star {
      font-size: 24px;
      color: #ccc;
      transition: color 0.2s;
      padding: 5px;
      -webkit-tap-highlight-color: transparent;
    }

    .star:hover, .star.active {
      color: var(--accent-color);
    }

    /* Formularz oceny z nickiem */
    .rating-form {
      margin-top: 15px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    .nickname-input {
      width: 200px;
      padding: 8px 12px;
      border: 1px solid var(--accent-color);
      border-radius: 4px;
      background: var(--primary-color);
      color: var(--text-color);
      margin-right: 10px;
    }

    /* Lista ocen u≈ºytkownik√≥w - r√≥wno u≈Ço≈ºone */
    .ratings-list {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
    }

    .ratings-list h4 {
      margin-bottom: 10px;
      border-bottom: 1px solid var(--text-color);
      padding-bottom: 5px;
    }

    .rating-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      margin: 5px 0;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 5px;
      gap: 15px;
      flex-wrap: wrap;
    }

    .rating-item-user {
      font-weight: bold;
      color: var(--accent-color);
      min-width: 120px;
      word-break: break-word;
    }

    .rating-item-stars {
      color: var(--accent-color);
      font-size: 18px;
      min-width: 100px;
      text-align: center;
    }

    .rating-item-time {
      font-size: 12px;
      opacity: 0.7;
      min-width: 150px;
      text-align: right;
    }

    /* Modal do zmiany oceny */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      display: none;
    }

    .modal-content {
      background: var(--card-color);
      padding: 25px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
      position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      background: #ff4444;
      color: white;
      border: none;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: #ff6666;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: flex-end;
    }

    .modal-cancel, .modal-confirm {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .modal-cancel {
      background: #666;
      color: white;
    }

    .modal-confirm {
      background: var(--accent-color);
      color: #000;
    }

    /* Loader */
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #ffd700;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Mobile styles */
    @media (max-width: 768px) {
      header h1 {
        font-size: 28px;
        padding-right: 50px;
      }
      
      .theme-toggle {
        top: 15px;
        right: 15px;
        width: 35px;
        height: 35px;
      }
      
      nav {
        gap: 15px;
        padding: 10px;
      }
      
      nav a {
        font-size: 16px;
        padding: 8px 12px;
      }
      
      .movie-grid, .series-grid, .game-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
      }
      
      .movie-img, .series-img, .game-img {
        height: 180px;
      }
      
      .section {
        padding: 20px 15px;
      }
      
      .columns {
        gap: 20px;
      }
      
      .column {
        min-width: 100%;
      }
      
      .nickname-input {
        width: 100%;
        margin-bottom: 10px;
        margin-right: 0;
      }
      
      .star {
        font-size: 32px;
        padding: 8px;
        min-width: 44px;
        min-height: 44px;
      }
      
      .rating-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
      
      .rating-item-user, .rating-item-stars, .rating-item-time {
        min-width: auto;
        width: 100%;
        text-align: left;
      }
      
      .rating-item-stars {
        font-size: 20px;
      }
      
      .filmweb-button, .trailer-button, .submit-rating, .change-rating-button {
        display: block;
        width: 100%;
        margin: 10px 0;
        text-align: center;
        padding: 15px;
        font-size: 18px;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      header h1 {
        font-size: 24px;
      }
      
      .movie-grid, .series-grid, .game-grid {
        grid-template-columns: 1fr;
      }
      
      .star {
        font-size: 36px;
        padding: 10px;
      }
    }
  </style>
</head>

<body data-theme="dark">

<header onclick="showSection('welcome')">
  <h1>Jan Nowacki - Strona osobista</h1>
  <button class="theme-toggle" onclick="toggleTheme(event)">üåô</button>
</header>

<nav>
  <a href="#" onclick="showSection('filmy')">üé¨ Filmy</a>
  <a href="#" onclick="showSection('gry')">üéÆ Gry</a>
  <a href="#" onclick="showSection('studia')">üìö Studia</a>
</nav>

<div id="welcome" class="section active">
  <div class="welcome-message">
    <h2>üëã Witaj na mojej stronie!</h2>
    <p>Nazywam siƒô Jan Nowacki i to jest moja osobista strona internetowa.</p>
    <p>Kliknij w jednƒÖ z zak≈Çadek powy≈ºej, aby zobaczyƒá moje ulubione filmy, gry i wiƒôcej!</p>
    <p><small>‚ú® System ocen spo≈Çeczno≈õciowych - prawdziwe globalne oceny dziƒôki Firebase!</small></p>
  </div>
</div>

<div id="filmy" class="section">
  <h2>Filmy i seriale</h2>
  
  <div class="search-container">
    <input type="text" class="search-input" id="movieSearch" placeholder="üîç Wyszukaj film lub serial..." onkeyup="searchMovies()">
  </div>

  <div class="columns">
    <div class="column">
      <h3>üé¨ Moje ulubione filmy</h3>
      <div class="movie-grid" id="movies-grid">
        <!-- Karty film√≥w bƒôdƒÖ generowane przez JavaScript -->
      </div>
    </div>

    <div class="column">
      <h3>üì∫ Moje ulubione seriale</h3>
      <div class="series-grid" id="series-grid">
        <!-- Karty seriali bƒôdƒÖ generowane przez JavaScript -->
      </div>
    </div>
  </div>
</div>

<!-- Sekcja szczeg√≥≈Ç√≥w filmu -->
<div id="movie-details" class="section" style="display: none;">
  <a href="#" class="back-link" onclick="showSection('filmy')">‚Üê Wr√≥ƒá do listy film√≥w</a>
  <div id="details-content"></div>
</div>

<!-- Sekcja szczeg√≥≈Ç√≥w serialu -->
<div id="series-details" class="section" style="display: none;">
  <a href="#" class="back-link" onclick="showSection('filmy')">‚Üê Wr√≥ƒá do listy seriali</a>
  <div id="series-content"></div>
</div>

<div id="gry" class="section">
  <h2>Moje ulubione gry</h2>
  
  <div class="search-container">
    <input type="text" class="search-input" id="gameSearch" placeholder="üîç Wyszukaj grƒô..." onkeyup="searchGames()">
  </div>

  <div class="game-grid" id="games-grid">
    <!-- Karty gier bƒôdƒÖ generowane przez JavaScript -->
  </div>
</div>

<!-- Sekcja szczeg√≥≈Ç√≥w gry -->
<div id="game-details" class="section" style="display: none;">
  <a href="#" class="back-link" onclick="showSection('gry')">‚Üê Wr√≥ƒá do listy gier</a>
  <div id="game-content"></div>
</div>

<div id="studia" class="section">
  <h2>Studia</h2>
  <p>Tu wkr√≥tce pojawiƒÖ siƒô informacje o mojej edukacji i studiach.</p>
  <p>... sekcja w budowie :)</p>
</div>

<!-- Modal do zmiany oceny -->
<div id="rating-modal" class="modal-overlay">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h3 id="modal-title">Zmie≈Ñ ocenƒô</h3>
    <p id="modal-message">Czy na pewno chcesz zmieniƒá swojƒÖ ocenƒô?</p>
    <div class="modal-buttons">
      <button class="modal-cancel" onclick="closeModal()">Anuluj</button>
      <button class="modal-confirm" onclick="confirmRatingChange()">Zmie≈Ñ</button>
    </div>
  </div>
</div>

<footer>
  ¬© 2026 Jan Nowacki - Moja osobista strona internetowa
</footer>

<script>
  // ========== KONFIGURACJA FIREBASE ==========
  // TUTAJ WKLEJ SWOJƒÑ KONFIGURACJƒò Z FIREBASE!
  // Poni≈ºej przyk≈Çadowa struktura - ZAMIENIƒÜ na swojƒÖ!
  const firebaseConfig = {
    apiKey: "AIzaSyBxXQ9eKjHjK...",
    authDomain: "jan-nowacki-oceny.firebaseapp.com",
    projectId: "jan-nowacki-oceny",
    storageBucket: "jan-nowacki-oceny.appspot.com",
    messagingSenderId: "123456789012",
    appId: "1:123456789012:web:abcdef1234567890"
  };

  // ========== INICJALIZACJA FIREBASE ==========
  let db;
  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    console.log("Firebase zainicjalizowane pomy≈õlnie!");
  } catch (error) {
    console.error("B≈ÇƒÖd Firebase:", error);
    alert("Firebase nie jest skonfigurowane! Skonfiguruj Firebase w kodzie.");
  }

  // ========== DANE FILM√ìW ==========
  const moviesData = [
    {
      id: 'dobry-zly-brzydki',
      title: 'ü§† Dobry, z≈Çy i brzydki',
      image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS0hThvye8txVEob0uSLdvO2UOWcvNW-iKOSg&s',
      desc: 'Klasyczny spaghetti western',
      type: 'film',
      year: '1966',
      director: 'Sergio Leone',
      trailer: 'https://www.youtube.com/watch?v=WCN5JJY_wiA'
    },
    {
      id: '12-gniewnych',
      title: '‚öñÔ∏è Dwunastu gniewnych ludzi',
      image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTToJ5elfoyvyhPJN-9aVj_Y7EssFG3Mp2O3A&s',
      desc: 'Dramat sƒÖdowy',
      type: 'film',
      year: '1957',
      director: 'Sidney Lumet',
      trailer: 'https://www.youtube.com/watch?v=_13J_9B5jEk'
    },
    {
      id: 'taxi-driver',
      title: 'üöï Taxi Driver',
      image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRHE1r1K79e6WHRmpKe3ViUl0Vwlb4ac_uyMg&s',
      desc: 'Dramat psychologiczny',
      type: 'film',
      year: '1976',
      director: 'Martin Scorsese',
      trailer: 'https://www.youtube.com/watch?v=UUxD4-dEzn0'
    },
    {
      id: 'lsnienie',
      title: 'üî™ L≈õnienie',
      image: 'https://img.goodfon.com/original/1920x1080/0/24/dzhek-nikolson-jack-nicholson.jpg',
      desc: 'Horror psychologiczny',
      type: 'film',
      year: '1980',
      director: 'Stanley Kubrick',
      trailer: 'https://www.youtube.com/watch?v=S014oGZiSdI'
    },
    {
      id: 'lot-nad-kukulczym-gniazdem',
      title: 'üè• Lot nad kuku≈Çczym gniazdem',
      image: 'https://upload.wikimedia.org/wikipedia/id/f/f6/One_flew_over_the_cuckoo%27s_nest_poster.jpeg',
      desc: 'Dramat psychiatryczny',
      type: 'film',
      year: '1975',
      director: 'Milo≈° Forman',
      trailer: 'https://www.youtube.com/watch?v=OXrcDonY-B8'
    },
    {
      id: 'piraci-karaiby',
      title: 'üè¥‚Äç‚ò†Ô∏è Piraci z Karaib√≥w',
      image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSs8SMTnEZ2TQdoSIrW14559B2HIRvucIKacw&s',
      desc: 'Przygodowy film akcji',
      type: 'film',
      year: '2003',
      director: 'Gore Verbinski',
      trailer: 'https://www.youtube.com/watch?v=naQr0uTrH_s'
    }
  ];

  const seriesData = [
    {
      id: 'breaking-bad',
      title: 'üß™ Breaking Bad',
      image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRd8UKB61gmfCnm2dxSshVYPbpePGGdMfXBYQ&s',
      desc: 'Dramat kryminalny',
      type: 'serial',
      seasons: '5 sezon√≥w',
      years: '2008-2013',
      trailer: 'https://www.youtube.com/watch?v=HhesaQXLuRY'
    },
    {
      id: 'stranger-things',
      title: 'üëæ Stranger Things',
      image: 'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/d96bb958-4e6c-4ce0-9447-fbe226fbbecf/df9nfag-55688aea-a979-4ba3-9473-38810d2f17e5.jpg',
      desc: 'Horror science fiction',
      type: 'serial',
      seasons: '4 sezony',
      years: '2016-obecnie',
      trailer: 'https://www.youtube.com/watch?v=b9EkMc79ZSU'
    }
  ];

  const gamesData = [
    {
      id: 'lol',
      title: '‚öîÔ∏è League of Legends',
      image: 'https://upload.wikimedia.org/wikipedia/commons/d/d8/League_of_Legends_2019_vector.svg',
      desc: 'MOBA (Multiplayer Online Battle Arena)',
      type: 'gra',
      genre: 'MOBA, Strategia',
      year: '2009',
      trailer: 'https://www.youtube.com/watch?v=BGtROJeMPeE'
    },
    {
      id: 'gta',
      title: 'üöó GTA V',
      image: 'https://upload.wikimedia.org/wikipedia/en/a/a5/Grand_Theft_Auto_V.png',
      desc: 'Gra akcji z otwartym ≈õwiatem',
      type: 'gra',
      genre: 'Akcja, Przygodowa',
      year: '2013',
      trailer: 'https://www.youtube.com/watch?v=QkkoHAzjnUs'
    },
    {
      id: 'fortnite',
      title: 'üè∞ Fortnite',
      image: 'https://upload.wikimedia.org/wikipedia/commons/7/7c/Fortnite_F_lettermark_logo.png',
      desc: 'Battle royale i gra survivalowa',
      type: 'gra',
      genre: 'Battle Royale, Survival',
      year: '2017',
      trailer: 'https://www.youtube.com/watch?v=2gUtfBmw86Y'
    },
    {
      id: 'rdr2',
      title: 'ü§† Red Dead Redemption 2',
      image: 'https://upload.wikimedia.org/wikipedia/en/4/44/Red_Dead_Redemption_II.jpg',
      desc: 'Gra akcji z otwartym ≈õwiatem',
      type: 'gra',
      genre: 'Akcja, Przygodowa',
      year: '2018',
      trailer: 'https://www.youtube.com/watch?v=eaW0tYpxyp0'
    }
  ];

  // ========== SYSTEM OCEN (FIREBASE) ==========
  let allRatingsCache = {};
  let currentUserNickname = localStorage.getItem('current_nickname') || '';
  let currentSelectedRating = 0;
  let currentRatingItemId = '';
  let currentRatingType = '';
  let modalCallback = null;

  // ≈Åaduje wszystkie oceny z Firebase
  async function loadAllRatings() {
    try {
      if (!db) {
        console.warn('Firebase nie jest zainicjalizowane');
        return {};
      }
      
      const snapshot = await db.collection('ratings').get();
      allRatingsCache = {};
      
      snapshot.forEach(doc => {
        const data = doc.data();
        allRatingsCache[doc.id] = data.ratings || [];
      });
      
      return allRatingsCache;
    } catch (error) {
      console.error('B≈ÇƒÖd ≈Çadowania ocen z Firebase:', error);
      return {};
    }
  }

  // Pobiera oceny dla konkretnego elementu
  function getRatingsForItem(itemId) {
    return allRatingsCache[itemId] || [];
  }

  // Sprawdza czy u≈ºytkownik ju≈º oceni≈Ç dany element
  function hasUserRated(itemId) {
    if (!currentUserNickname) return false;
    const ratings = getRatingsForItem(itemId);
    return ratings.some(r => r.nickname === currentUserNickname);
  }

  // Pobiera ocenƒô u≈ºytkownika dla danego elementu
  function getUserRating(itemId) {
    if (!currentUserNickname) return null;
    const ratings = getRatingsForItem(itemId);
    return ratings.find(r => r.nickname === currentUserNickname);
  }

  // Dodaje lub aktualizuje ocenƒô w Firebase
  async function saveRating(itemId, ratingData) {
    try {
      if (!db) {
        throw new Error('Firebase nie jest zainicjalizowane');
      }
      
      const ratings = getRatingsForItem(itemId);
      let updatedRatings;
      
      // Sprawd≈∫ czy ten nick ju≈º ocenia≈Ç
      const existingIndex = ratings.findIndex(r => r.nickname === ratingData.nickname);
      
      if (existingIndex !== -1) {
        // Aktualizuj istniejƒÖcƒÖ ocenƒô
        ratings[existingIndex] = {
          nickname: ratingData.nickname,
          rating: ratingData.rating,
          timestamp: new Date().toISOString()
        };
        updatedRatings = ratings;
      } else {
        // Dodaj nowƒÖ ocenƒô
        updatedRatings = [...ratings, {
          nickname: ratingData.nickname,
          rating: ratingData.rating,
          timestamp: new Date().toISOString()
        }];
      }
      
      // Zapisz nick u≈ºytkownika lokalnie
      if (!currentUserNickname || currentUserNickname !== ratingData.nickname) {
        currentUserNickname = ratingData.nickname;
        localStorage.setItem('current_nickname', currentUserNickname);
      }
      
      // Zapisz do Firebase
      await db.collection('ratings').doc(itemId).set({
        ratings: updatedRatings,
        lastUpdated: new Date().toISOString()
      }, { merge: true });
      
      // Zaktualizuj cache
      allRatingsCache[itemId] = updatedRatings;
      
      return true;
    } catch (error) {
      console.error('B≈ÇƒÖd zapisywania oceny w Firebase:', error);
      return false;
    }
  }

  // Oblicza ≈õredniƒÖ ocen
  function calculateAverageRating(ratings) {
    if (ratings.length === 0) return 0;
    const sum = ratings.reduce((total, r) => total + r.rating, 0);
    return sum / ratings.length;
  }

  // Formatuje gwiazdki
  function getStarsHTML(rating) {
    let stars = '';
    const roundedRating = Math.round(rating);
    for (let i = 1; i <= 5; i++) {
      stars += i <= roundedRating ? '‚òÖ' : '‚òÜ';
    }
    return stars;
  }

  // Formatuje datƒô
  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleString('pl-PL', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  // ========== MODAL ==========
  function showModal(title, message, callback) {
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-message').textContent = message;
    modalCallback = callback;
    document.getElementById('rating-modal').style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('rating-modal').style.display = 'none';
    modalCallback = null;
  }

  function confirmRatingChange() {
    if (modalCallback) {
      modalCallback();
    }
    closeModal();
  }

  // ========== FUNKCJE G≈Å√ìWNE ==========
  let currentSection = 'welcome';
  
  function showSection(id) {
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => {
      section.style.display = 'none';
      section.classList.remove('active');
    });
    document.getElementById(id).style.display = 'block';
    document.getElementById(id).classList.add('active');
    currentSection = id;
    
    if (id === 'filmy') {
      loadMovies();
      loadSeries();
    } else if (id === 'gry') {
      loadGames();
    }
  }

  // ========== MOTYW ==========
  function toggleTheme(event) {
    event.stopPropagation();
    const currentTheme = document.body.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.body.setAttribute('data-theme', newTheme);
    
    const button = document.querySelector('.theme-toggle');
    button.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    button.style.color = '#000';
    
    localStorage.setItem('theme', newTheme);
    
    if (currentSection === 'filmy') {
      loadMovies();
      loadSeries();
    } else if (currentSection === 'gry') {
      loadGames();
    } else if (currentSection.startsWith('movie-details-')) {
      const id = currentSection.replace('movie-details-', '');
      showMovieDetails(id);
    } else if (currentSection.startsWith('series-details-')) {
      const id = currentSection.replace('series-details-', '');
      showSeriesDetails(id);
    } else if (currentSection.startsWith('game-details-')) {
      const id = currentSection.replace('game-details-', '');
      showGameDetails(id);
    }
  }

  // ========== WYSZUKIWARKA ==========
  function searchMovies() {
    const searchTerm = document.getElementById('movieSearch').value.toLowerCase();
    const movieCards = document.querySelectorAll('.movie-card, .series-card');
    
    movieCards.forEach(card => {
      const title = card.querySelector('.movie-title, .series-title').textContent.toLowerCase();
      const desc = card.querySelector('.movie-desc, .series-desc').textContent.toLowerCase();
      card.style.display = (title.includes(searchTerm) || desc.includes(searchTerm)) ? 'block' : 'none';
    });
  }

  function searchGames() {
    const searchTerm = document.getElementById('gameSearch').value.toLowerCase();
    const gameCards = document.querySelectorAll('.game-card');
    
    gameCards.forEach(card => {
      const title = card.querySelector('.game-title').textContent.toLowerCase();
      const desc = card.querySelector('.game-desc').textContent.toLowerCase();
      card.style.display = (title.includes(searchTerm) || desc.includes(searchTerm)) ? 'block' : 'none';
    });
  }

  // ========== ≈ÅADOWANIE DANYCH ==========
  async function loadMovies() {
    const grid = document.getElementById('movies-grid');
    if (!grid) return;
    
    // Poka≈º loader
    grid.innerHTML = '<div class="loader"></div>';
    
    await loadAllRatings();
    
    grid.innerHTML = '';
    
    moviesData.forEach(movie => {
      const ratings = getRatingsForItem(movie.id);
      const avgRating = calculateAverageRating(ratings);
      const ratingCount = ratings.length;
      
      grid.innerHTML += `
        <div class="movie-card" onclick="showMovieDetails('${movie.id}')" data-id="${movie.id}">
          ${ratingCount > 0 ? `<div class="card-rating-badge">‚≠ê ${avgRating.toFixed(1)}</div>` : ''}
          <img src="${movie.image}" alt="${movie.title}" class="movie-img">
          <div class="movie-info">
            <div class="movie-title">${movie.title}</div>
            <div class="movie-desc">${movie.desc} (${movie.year})</div>
            <div class="card-rating">
              <div class="rating-stars">${getStarsHTML(avgRating)}</div>
              <div class="rating-count">(${ratingCount} g≈Ços√≥w)</div>
            </div>
          </div>
        </div>
      `;
    });
  }

  async function loadSeries() {
    const grid = document.getElementById('series-grid');
    if (!grid) return;
    
    await loadAllRatings();
    grid.innerHTML = '';
    
    seriesData.forEach(series => {
      const ratings = getRatingsForItem(series.id);
      const avgRating = calculateAverageRating(ratings);
      const ratingCount = ratings.length;
      
      grid.innerHTML += `
        <div class="series-card" onclick="showSeriesDetails('${series.id}')" data-id="${series.id}">
          ${ratingCount > 0 ? `<div class="card-rating-badge">‚≠ê ${avgRating.toFixed(1)}</div>` : ''}
          <img src="${series.image}" alt="${series.title}" class="series-img">
          <div class="series-info">
            <div class="series-title">${series.title}</div>
            <div class="series-desc">${series.desc}</div>
            <div class="card-rating">
              <div class="rating-stars">${getStarsHTML(avgRating)}</div>
              <div class="rating-count">(${ratingCount} g≈Ços√≥w)</div>
            </div>
          </div>
        </div>
      `;
    });
  }

  async function loadGames() {
    const grid = document.getElementById('games-grid');
    if (!grid) return;
    
    await loadAllRatings();
    grid.innerHTML = '';
    
    gamesData.forEach(game => {
      const ratings = getRatingsForItem(game.id);
      const avgRating = calculateAverageRating(ratings);
      const ratingCount = ratings.length;
      
      grid.innerHTML += `
        <div class="game-card" onclick="showGameDetails('${game.id}')" data-id="${game.id}">
          ${ratingCount > 0 ? `<div class="card-rating-badge">‚≠ê ${avgRating.toFixed(1)}</div>` : ''}
          <img src="${game.image}" alt="${game.title}" class="game-img" style="${game.id === 'lol' || game.id === 'fortnite' ? 'background: white; padding: 20px;' : ''}">
          <div class="game-info">
            <div class="game-title">${game.title}</div>
            <div class="game-desc">${game.desc} (${game.year})</div>
            <div class="card-rating">
              <div class="rating-stars">${getStarsHTML(avgRating)}</div>
              <div class="rating-count">(${ratingCount} g≈Ços√≥w)</div>
            </div>
          </div>
        </div>
      `;
    });
  }

  // ========== SZCZEG√ì≈ÅY Z SYSTEMEM OCEN ==========
  async function showMovieDetails(id) {
    const movie = moviesData.find(m => m.id === id);
    if (!movie) return;
    
    await loadAllRatings();
    
    currentRatingItemId = id;
    currentRatingType = 'film';
    currentSection = `movie-details-${id}`;
    
    const ratings = getRatingsForItem(id);
    const avgRating = calculateAverageRating(ratings);
    const userRating = getUserRating(id);
    
    document.getElementById('details-content').innerHTML = `
      <div style="display: flex; flex-wrap: wrap; gap: 30px;">
        <img src="${movie.image}" alt="${movie.title}" style="width: 100%; max-width: 300px; height: 450px; object-fit: cover; border-radius: 10px;">
        <div style="flex: 1; min-width: 300px;">
          <h2 style="margin-top: 0;">${movie.title}</h2>
          <p style="font-size: 18px;">${movie.desc}</p>
          <p><strong>Rok produkcji:</strong> ${movie.year}</p>
          <p><strong>Re≈ºyser:</strong> ${movie.director}</p>
          
          <div class="details-rating">
            <h3>Oce≈Ñ ten film:</h3>
            <div class="rating-container">
              <div class="user-rating" id="rating-stars-${movie.id}">
                ${[1,2,3,4,5].map(star => `
                  <span class="star" data-value="${star}" 
                        onclick="selectRating(${star}, '${movie.id}')"
                        onmouseover="highlightStars(${star}, '${movie.id}')"
                        onmouseout="resetStars('${movie.id}')">‚òÖ</span>
                `).join('')}
              </div>
              <div>≈örednia: <strong>${avgRating.toFixed(1)}/5</strong> (${ratings.length} g≈Ços√≥w)</div>
            </div>
            
            ${userRating ? `
              <div style="margin-top: 10px; padding: 10px; background: rgba(255, 215, 0, 0.1); border-radius: 5px;">
                <p>Twoja ocena jako <strong>${userRating.nickname}</strong>: <strong>${getStarsHTML(userRating.rating)} (${userRating.rating}/5)</strong></p>
                <p><small>Wystawiona: ${formatDate(userRating.timestamp)}</small></p>
                <button class="change-rating-button" onclick="prepareRatingChange('${movie.id}', 'film')">
                  ‚úèÔ∏è Zmie≈Ñ ocenƒô
                </button>
              </div>
            ` : `
              <div class="rating-form">
                <input type="text" id="nickname-${movie.id}" class="nickname-input" 
                       placeholder="Tw√≥j nick" maxlength="20" value="${currentUserNickname}">
                <button class="submit-rating" onclick="submitRating('${movie.id}', 'film')">Dodaj ocenƒô</button>
                <p><small>Podaj nick i wybierz ocenƒô. Mo≈ºesz p√≥≈∫niej zmieniƒá swojƒÖ ocenƒô.</small></p>
              </div>
            `}
            
            ${ratings.length > 0 ? `
            <div class="ratings-list">
              <h4>Oceny spo≈Çeczno≈õci (${ratings.length}):</h4>
              ${ratings.map(rating => `
                <div class="rating-item">
                  <span class="rating-item-user">${rating.nickname}</span>
                  <span class="rating-item-stars" title="${rating.rating}/5">${getStarsHTML(rating.rating)} (${rating.rating}/5)</span>
                  <span class="rating-item-time">${formatDate(rating.timestamp)}</span>
                </div>
              `).reverse().join('')}
            </div>
            ` : '<p>Brak ocen. BƒÖd≈∫ pierwszy!</p>'}
          </div>
          
          <div>
            <a href="${movie.trailer}" target="_blank" class="trailer-button">
              üé¨ Obejrzyj zwiastun
            </a>
            <a href="https://www.filmweb.pl/user/JasieKnow" target="_blank" class="filmweb-button">
              üìñ M√≥j profil Filmweb
            </a>
          </div>
        </div>
      </div>
    `;
    
    // Ustaw aktualnƒÖ ocenƒô u≈ºytkownika je≈õli jƒÖ ma
    if (userRating) {
      currentSelectedRating = userRating.rating;
      resetStars(id);
    } else {
      currentSelectedRating = 0;
    }
    
    showSection('movie-details');
  }

  // ... (showSeriesDetails i showGameDetails - podobnie jak showMovieDetails)

  // ========== FUNKCJE SYSTEMU OCEN ==========
  function selectRating(rating, id) {
    currentSelectedRating = rating;
    currentRatingItemId = id;
    
    const stars = document.querySelectorAll(`#rating-stars-${id} .star`);
    stars.forEach((star, index) => {
      if (index < rating) {
        star.classList.add('active');
      } else {
        star.classList.remove('active');
      }
    });
  }

  function highlightStars(count, id) {
    const stars = document.querySelectorAll(`#rating-stars-${id} .star`);
    stars.forEach((star, index) => {
      if (index < count) {
        star.classList.add('active');
      }
    });
  }

  function resetStars(id) {
    const stars = document.querySelectorAll(`#rating-stars-${id} .star`);
    stars.forEach((star, index) => {
      if (index < currentSelectedRating) {
        star.classList.add('active');
      } else {
        star.classList.remove('active');
      }
    });
  }

  function prepareRatingChange(itemId, type) {
    if (currentSelectedRating === 0) {
      alert('Proszƒô wybraƒá nowƒÖ ocenƒô (kliknij w gwiazdki)!');
      return;
    }
    
    showModal(
      'Zmie≈Ñ ocenƒô',
      `Czy na pewno chcesz zmieniƒá swojƒÖ ocenƒô na ${currentSelectedRating} gwiazdek?`,
      () => submitRating(itemId, type, true)
    );
  }

  async function submitRating(id, type, isChange = false) {
    const nicknameInput = document.getElementById(`nickname-${id}`);
    const nickname = nicknameInput ? nicknameInput.value.trim() : currentUserNickname;
    
    if (!nickname) {
      alert('Proszƒô podaƒá nick!');
      if (nicknameInput) nicknameInput.focus();
      return;
    }
    
    if (currentSelectedRating === 0) {
      alert('Proszƒô wybraƒá ocenƒô (kliknij w gwiazdki)!');
      return;
    }
    
    const success = await saveRating(id, {
      nickname: nickname,
      rating: currentSelectedRating
    });
    
    if (success) {
      alert(isChange ? 'Ocena zosta≈Ça zmieniona!' : 'Dziƒôkujƒô za ocenƒô!');
      
      // Od≈õwie≈º wy≈õwietlanie
      if (type === 'film') {
        await showMovieDetails(id);
        await loadMovies();
      } else if (type === 'serial') {
        await showSeriesDetails(id);
        await loadSeries();
      } else {
        await showGameDetails(id);
        await loadGames();
      }
    } else {
      alert('WystƒÖpi≈Ç b≈ÇƒÖd przy zapisywaniu oceny. Sprawd≈∫ konfiguracjƒô Firebase.');
    }
  }

  // ========== INICJALIZACJA ==========
  document.addEventListener('DOMContentLoaded', async function() {
    // Za≈Çaduj zapisany motyw
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    const themeButton = document.querySelector('.theme-toggle');
    themeButton.textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    themeButton.style.color = '#000';
    
    // Pokazuj stronƒô startowƒÖ
    showSection('welcome');
    
    // Zamknij modal przy klikniƒôciu na overlay
    document.getElementById('rating-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
    
    // Zamknij modal przy Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
    
    // Inicjalizuj Firebase i za≈Çaduj oceny
    try {
      await loadAllRatings();
    } catch (error) {
      console.error('B≈ÇƒÖd inicjalizacji:', error);
    }
  });

  // Poprawka dla touch
  document.addEventListener('touchstart', function() {}, {passive: true});
</script>
</body>
</html>
